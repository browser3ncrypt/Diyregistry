<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Browser Terminal Playground (xterm.js simulation)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5/css/xterm.css" integrity="sha256-oS7knOK+3s3D8vSKM9FazL0oYQ3sEHDpGq0kD+3GqS0=" crossorigin="anonymous"/>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: #000;
      font-family: 'Courier New', Courier, monospace;
      overflow: hidden;
    }
    #terminal {
      width: 100%;
      height: 100%;
    }
    .header {
      position: absolute;
      top: 8px;
      left: 16px;
      color: #0f0;
      font-size: 14px;
      z-index: 10;
      pointer-events: none;
    }
  </style>
</head>
<body>

<div class="header">Browser Terminal Playground  —  type 'help' for commands</div>

<div id="terminal"></div>

<script src="https://cdn.jsdelivr.net/npm/xterm@5/+esm"></script>
<script type="module">
  const { Terminal } = XTerm;

  // ──────────────────────────────────────────────
  // Virtual File System & State
  // ──────────────────────────────────────────────
  let currentDir = '/home/user';
  const fileSystem = {
    '/':          ['home', 'etc', 'tmp'],
    '/home':      ['user'],
    '/home/user': ['Documents', 'Downloads', 'Desktop', 'README.md'],
    '/etc':       ['hosts', 'passwd'],
    '/tmp':       []
  };

  const filesContent = {
    '/home/user/README.md': 'Welcome to the browser terminal playground.\nThis is a static simulation.\nHave fun!'
  };

  // ──────────────────────────────────────────────
  // Terminal Setup
  // ──────────────────────────────────────────────
  const term = new Terminal({
    cursorBlink: true,
    theme: {
      background: '#000000',
      foreground: '#00ff41',
      cursor:     '#00ff41'
    },
    fontFamily: "'Courier New', monospace",
    fontSize: 15,
    lineHeight: 1.2
  });

  term.open(document.getElementById('terminal'));
  term.resize(Math.floor(window.innerWidth / 9.2), Math.floor(window.innerHeight / 18));

  window.addEventListener('resize', () => {
    term.resize(Math.floor(window.innerWidth / 9.2), Math.floor(window.innerHeight / 18));
  });

  // Prompt
  function prompt() {
    term.write(`\r\n\x1b[32muser@playground\x1b[0m:\x1b[34m\( {currentDir}\x1b[0m \) `);
  }

  term.write('\x1b[32mBrowser Terminal Playground\x1b[0m — static simulation\r\n');
  prompt();

  // ──────────────────────────────────────────────
  // Command Handler
  // ──────────────────────────────────────────────
  let commandBuffer = '';

  term.onKey(({ key, domEvent }) => {
    if (domEvent.key === 'Enter') {
      term.write('\r\n');
      const cmd = commandBuffer.trim();
      commandBuffer = '';

      if (cmd) {
        executeCommand(cmd);
      }
      prompt();
    }
    else if (domEvent.key === 'Backspace') {
      if (commandBuffer.length > 0) {
        commandBuffer = commandBuffer.slice(0, -1);
        term.write('\b \b');
      }
      domEvent.preventDefault();
    }
    else if (domEvent.ctrlKey && domEvent.key.toLowerCase() === 'c') {
      term.write('^C\r\n');
      commandBuffer = '';
      prompt();
      domEvent.preventDefault();
    }
    else if (!domEvent.ctrlKey && !domEvent.metaKey && key.length === 1) {
      commandBuffer += key;
      term.write(key);
    }
  });

  function executeCommand(input) {
    const parts = input.split(/\s+/);
    const cmd = parts[0].toLowerCase();
    const args = parts.slice(1);

    switch (cmd) {
      case 'help':
        term.writeln('Available commands:');
        term.writeln('  help          — show this help');
        term.writeln('  clear         — clear the screen');
        term.writeln('  pwd           — print working directory');
        term.writeln('  ls            — list directory contents');
        term.writeln('  cd <dir>      — change directory (cd .., cd /, cd Documents)');
        term.writeln('  echo <text>   — print text');
        term.writeln('  cat <file>    — show file content (only README.md exists)');
        term.writeln('  date          — show current date/time');
        term.writeln('  whoami        — show current user');
        break;

      case 'clear':
        term.clear();
        break;

      case 'pwd':
        term.writeln(currentDir);
        break;

      case 'ls':
        const dir = currentDir === '/' ? '/' : currentDir;
        const items = fileSystem[dir] || [];
        if (items.length === 0) {
          term.writeln('(empty directory)');
        } else {
          term.writeln(items.join('  '));
        }
        break;

      case 'cd':
        if (args.length === 0) {
          currentDir = '/home/user';
          break;
        }
        let target = args[0];
        if (target === '..') {
          if (currentDir !== '/') {
            currentDir = currentDir.split('/').slice(0, -1).join('/') || '/';
          }
        } else if (target.startsWith('/')) {
          currentDir = target;
        } else {
          currentDir = currentDir === '/' ? `/\( {target}` : ` \){currentDir}/${target}`;
        }
        if (!fileSystem[currentDir]) {
          term.writeln(`cd: ${target}: No such file or directory`);
          currentDir = currentDir.split('/').slice(0, -1).join('/') || '/'; // revert
        }
        break;

      case 'echo':
        term.writeln(args.join(' '));
        break;

      case 'cat':
        if (args.length === 0) {
          term.writeln('cat: missing operand');
          break;
        }
        const filePath = args[0].startsWith('/') ? args[0] : `\( {currentDir}/ \){args[0]}`;
        if (filesContent[filePath]) {
          term.writeln(filesContent[filePath]);
        } else {
          term.writeln(`cat: ${args[0]}: No such file or directory`);
        }
        break;

      case 'date':
        term.writeln(new Date().toLocaleString());
        break;

      case 'whoami':
        term.writeln('user');
        break;

      default:
        if (cmd) {
          term.writeln(`${cmd}: command not found`);
        }
    }
  }
</script>
</body>
</html>
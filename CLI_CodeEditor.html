<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Browser Playground — Terminal + Code Editor</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/codemirror.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/mode/python/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.0.1/mode/css/css.min.js"></script>

  <style>
    :root {
      --bg: #1e1e1e;
      --text: #d4d4d4;
      --prompt: #4ec9b0;
      --border: #3c3c3c;
      --editor-bg: #252526;
      --btn-bg: #007acc;
      --btn-hover: #005f99;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: monospace;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header {
      padding: 0.6rem 1rem;
      background: #2d2d2d;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      margin: 0;
      font-size: 1.1rem;
    }

    main {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    #editor-container, #terminal-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }

    #terminal-container {
      border-right: none;
    }

    #editor {
      flex: 1;
      overflow: hidden;
    }

    #terminal {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: var(--editor-bg);
    }

    .output-line {
      margin: 0.2rem 0;
      white-space: pre-wrap;
    }

    .prompt { color: var(--prompt); }

    #input-container {
      display: flex;
      align-items: center;
      padding: 0.5rem 1rem;
      background: var(--bg);
      border-top: 1px solid var(--border);
    }

    #prompt { color: var(--prompt); margin-right: 0.5rem; }

    #input {
      flex: 1;
      background: none;
      border: none;
      color: var(--text);
      font-family: monospace;
      font-size: 1rem;
      outline: none;
    }

    #controls {
      padding: 0.6rem 1rem;
      background: #2d2d2d;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    button {
      background: var(--btn-bg);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover { background: var(--btn-hover); }

    #keyboard {
      display: none;
      flex-wrap: wrap;
      padding: 1rem;
      background: #333;
      justify-content: center;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }

    .key {
      background: #444;
      color: #d4d4d4;
      border: 1px solid #555;
      padding: 0.5rem;
      margin: 0.2rem;
      cursor: pointer;
      border-radius: 4px;
      min-width: 2.2rem;
      text-align: center;
    }

    .key:hover { background: #555; }
    .key:active { background: #666; }
    .special { background: #555; min-width: 5rem; }

    #toggle-keyboard {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 101;
    }
  </style>
</head>
<body>

<header>
  <h1>Browser Playground — Terminal + Code Editor</h1>
  <button id="toggle-keyboard">Show Virtual Keyboard</button>
</header>

<main>
  <div id="editor-container">
    <div id="editor"></div>
  </div>

  <div id="terminal-container">
    <div id="terminal"></div>
    <div id="input-container">
      <span id="prompt">$</span>
      <input type="text" id="input" autocomplete="off" autofocus />
    </div>
  </div>
</main>

<div id="controls">
  <button id="run-code">Run Code (JavaScript)</button>
  <span style="color:#aaa; font-size:0.9rem;">
    Editor supports JS / Python / HTML / CSS highlighting — execution is JS only
  </span>
</div>

<div id="keyboard">
  <div class="key">q</div><div class="key">w</div><div class="key">e</div><div class="key">r</div><div class="key">t</div>
  <div class="key">y</div><div class="key">u</div><div class="key">i</div><div class="key">o</div><div class="key">p</div>
  <div class="key">a</div><div class="key">s</div><div class="key">d</div><div class="key">f</div><div class="key">g</div>
  <div class="key">h</div><div class="key">j</div><div class="key">k</div><div class="key">l</div>
  <div class="key">z</div><div class="key">x</div><div class="key">c</div><div class="key">v</div><div class="key">b</div>
  <div class="key">n</div><div class="key">m</div>
  <div class="key special" data-key="Backspace">← Backspace</div>
  <div class="key special" data-key=" ">Space</div>
  <div class="key special" data-key="Enter">⏎ Enter</div>
</div>

<script>
// ────────────────────────────────────────────────
//  Terminal logic
// ────────────────────────────────────────────────

const terminal   = document.getElementById('terminal');
const input      = document.getElementById('input');
const keyboard   = document.getElementById('keyboard');
const toggleKb   = document.getElementById('toggle-keyboard');

let currentDir = '/';

const fileSystem = {
  '/': {
    type: 'dir',
    contents: {
      'readme.md': { type: 'file', content: '# Welcome\nThis is a small simulated file system.' },
      'script.js': { type: 'file', content: 'console.log("Hello from simulated file");' }
    }
  }
};

const commands = {
  help: () => 'Commands: help, ls, cd, pwd, echo, cat, clear',
  ls:   (args) => {
    const dir = resolvePath(args[0] || currentDir);
    return dir?.type === 'dir' ? Object.keys(dir.contents).join('  ') : 'No such directory';
  },
  cd:   (args) => {
    if (!args[0]) return 'Usage: cd <path>';
    const target = resolvePath(args[0]);
    if (target?.type === 'dir') {
      currentDir = normalizePath(args[0]);
      return '';
    }
    return 'No such directory';
  },
  pwd:  () => currentDir,
  echo: (args) => args.join(' '),
  cat:  (args) => {
    if (!args[0]) return 'Usage: cat <file>';
    const file = resolvePath(args[0]);
    return file?.type === 'file' ? file.content : 'No such file';
  },
  clear:() => { terminal.innerHTML = ''; return ''; }
};

function normalizePath(p) {
  let parts = (currentDir + '/' + p).split('/').filter(Boolean);
  return '/' + parts.join('/');
}

function resolvePath(path) {
  let parts = (path.startsWith('/') ? path : currentDir + '/' + path)
    .split('/').filter(p => p && p !== '.');
  let node = fileSystem['/'];
  for (let seg of parts) {
    if (seg === '..') continue; // very basic
    if (node.contents?.[seg]) node = node.contents[seg];
    else return null;
  }
  return node;
}

function append(text, cls = 'output-line') {
  const div = document.createElement('div');
  div.className = cls;
  div.textContent = text;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

function runCommand(cmd) {
  if (!cmd.trim()) return;
  append(`$ ${cmd}`, 'prompt');

  const [command, ...args] = cmd.trim().split(/\s+/);
  if (commands[command]) {
    const out = commands[command](args);
    if (out) append(out);
  } else if (command) {
    append(`command not found: ${command}`);
  }
}

input.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    runCommand(input.value);
    input.value = '';
  }
});

// ────────────────────────────────────────────────
//  CodeMirror editor
// ────────────────────────────────────────────────

const editor = new CodeMirror.EditorView({
  doc: `// Example JavaScript\nconsole.log("Hello from the editor");\n\n// You can write multi-line code here\nlet x = 42;\nconsole.log("The answer is", x);`,
  extensions: [
    CodeMirror.basicSetup,
    CodeMirror.javascript({ jsx: true }),
    CodeMirror.EditorView.lineWrapping,
  ],
  parent: document.getElementById('editor')
});

document.getElementById('run-code').onclick = () => {
  const code = editor.state.doc.toString();
  append('─ Executing code from editor ─', 'output-line');

  try {
    const fn = new Function(code);
    const result = fn();
    if (result !== undefined) {
      append(`→ ${result}`, 'output-line');
    }
  } catch (err) {
    append(`Error: ${err.message}`, 'output-line');
    console.error(err);
  }
};

// ────────────────────────────────────────────────
//  Virtual keyboard
// ────────────────────────────────────────────────

toggleKb.onclick = () => {
  const show = keyboard.style.display !== 'flex';
  keyboard.style.display = show ? 'flex' : 'none';
  toggleKb.textContent = show ? 'Hide Keyboard' : 'Show Virtual Keyboard';
};

keyboard.addEventListener('click', e => {
  if (!e.target.classList.contains('key')) return;
  const key = e.target.dataset.key || e.target.textContent.trim();

  if (key === 'Backspace') {
    input.value = input.value.slice(0, -1);
  } else if (key === 'Enter') {
    input.dispatchEvent(new KeyboardEvent('keydown', {key:'Enter', bubbles:true}));
  } else {
    input.value += key;
  }

  input.focus();
});

// Welcome message
append('Browser Playground — type "help" for terminal commands');
append('Use the code editor on the left and press "Run Code" to execute JavaScript');
</script>

</body>
</html>